# boosted-lorenzetti

## Overview

This repository is dedicated to the development of machine learning models for electron identification in high-energy physics experiments. The models are trained and evaluated using data generated by the [Lorenzetti Shower Simulator software](https://github.com/lorenzetti-hep/lorenzetti), which simulates particle showers in calorimeters.

## Features

- Data preprocessing and conversion utilities for Lorenzetti-generated datasets ([ROOT](https://root.cern/) files, DuckDB, Parquet, etc.)
- PyTorch-based training scripts for different Machine Learning models.
- Model evaluation and metrics logging with [MLFlow](https://mlflow.org/) integration.
- Jupyter notebooks for data analysis, model comparison, and profiling
- Utilities for handling large datasets and experiment tracking

## Getting Started

1. **Install dependencies**: Pull the desired version from [docker hub](https://hub.docker.com/r/lucasbanunes/boosted-lorenzetti/tags) or create a conda environment with ROOT and install `requirements.txt` just like bellow.
```bash
conda init
conda config --set channel_priority strict
conda create -c conda-forge --name dev root==6.34.04 python==3.11.13
conda run -n dev --live-stream pip install -r requirements.txt
```
2. **Prepare data**: Place Lorenzetti-generated files in the appropriate data directory (see `data/lorenzetti/v2.2.0/`).
3. **Train models**: Use scripts in the repository (e.g., `fit_cnn.py`, `adjust_number.py`) or explore the provided notebooks.
4. **Analyze results**: Use the analysis notebooks and MLflow tracking for model comparison and performance evaluation.

## Project Structure

- `boosted_lorenzetti/` — Core Python package with data handling, model training, and evaluation modules
- `datasets/` — Examples cripts to generate datasets with Lorenzetti
- `scripts/` — Helper scripts for running experiments, specially on slurm clusters
- `tests/` — Unit tests for core functionality

## Data Format

Supported formats include DuckDB and Parquet, as produced by the Lorenzetti Shower Simulator. Example files are located in `tests/data/`.

## Usage Example

```bash
conda activate blzt
python cli.py mlp create-kfold 100 2 1 \
    --db-path tests/data/test_dataset.duckdb \
    --table-name "data" \
    --best-metric "val_max_sp" \
    --best-metric-mode "max" \
    --rings-col "cl_rings" \
    --label-col "label" \
    --fold-col "fold" \
    --activation "relu" \
    --batch-size 32 \
    --patience 5 \
    --fold 5 \
    --inits 5 \
    --max-epochs 1000 \
    --name "mlp-kfold-multi-init-zee-jf17" \
    --tracking-uri "file://${HOME}/mlruns" \
    --experiment-name "boosted-lorenzetti"
```

## Citation

If you use this repository or the Lorenzetti Shower Simulator in your research, please cite appropriately.

## License

This project is licensed under the MIT License.

